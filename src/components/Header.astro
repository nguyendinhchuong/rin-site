---
import { sanityClient, urlFor } from '@/lib/sanity';
import { siteSettingsQuery } from '@/lib/queries';
import Navigation from './Navigation';

const currentLocale = Astro.url.pathname.startsWith('/en') ? 'en' : 'vi';

const siteSettings = await sanityClient.fetch(siteSettingsQuery, {
  language: currentLocale,
});

const logoUrl = siteSettings?.logo ? urlFor(siteSettings.logo).width(180).url() : '';
---

<header class="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
  <div class="container mx-auto flex h-16 items-center justify-between px-4">
    <div class="flex items-center gap-8">
      <a href={`/${currentLocale}`} class="flex items-center space-x-2">
        {logoUrl ? (
          <img src={logoUrl} alt={siteSettings?.siteName} class="h-10" />
        ) : (
          <span class="text-xl font-bold">{siteSettings?.siteName}</span>
        )}
      </a>
    </div>

    <Navigation client:load currentLocale={currentLocale} />

    <div class="flex items-center gap-4">
      <!-- Language Switcher -->
      <div class="flex items-center gap-2">
        <a
          href={Astro.url.pathname.replace(/^\/(vi|en)/, '/vi')}
          class={`px-3 py-1 rounded ${currentLocale === 'vi' ? 'bg-primary text-primary-foreground' : 'hover:bg-muted'}`}
        >
          VI
        </a>
        <a
          href={Astro.url.pathname.replace(/^\/(vi|en)/, '/en')}
          class={`px-3 py-1 rounded ${currentLocale === 'en' ? 'bg-primary text-primary-foreground' : 'hover:bg-muted'}`}
        >
          EN
        </a>
      </div>
    </div>
  </div>
</header>

